library(DBI)
library(dplyr)
library(ggplot2)
library(redivis.bigrquery)

devtools::install_github("redivis/bigrquery")

Sys.setenv(REDIVIS_API_TOKEN = "AAAAJvpMAQJ/mzoHreN8SNdaciS4MKzn")

con <- dbConnect(redivis.bigrquery::bigquery())

##username.projectname.tablename
dc_tax <- tbl(con, "joshquan.corelogic_jq.corelogic_example")

str(wa_tax)
wa_tax %>% filter(FIPS_CODE == 53059) %>% ggplot(aes(BEDROOMS)) + geom_histogram()


#owner_name.dataset_name[:v{version}][:sample][:{dataset_id}].table_name[:{table_id}]


# Washington Post example

library(dplyr)
library(DBI)

#get api key from settings > API Tokens

REDIVIS_API_TOKEN="AAAAgKdosU+KEhmqPd+4EEe01QAOpFLD"

library(redivis.bigrquery)

sql <- "SELECT
    publish_date
    FROM `sul.washington_post.articles_1969`
    LIMIT 10"
tb <- bq_project_query(sql)

## Python code
# pipenv install -e "git+https://github.com/redivis/redipy.git#egg=redivis-bigquery&subdirectory=bigquery"
# REDIVIS_API_TOKEN="AAAAJvpMAQJ/mzoHreN8SNdaciS4MKzn" pipenv run python
# from redivis import bigquery
# client = bigquery.Client()
# QUERY = ('SELECT * FROM `joshquan.corelogic_jq.corelogic_example` LIMIT 10')
# df = client.query(QUERY).to_dataframe()
# print(df)



